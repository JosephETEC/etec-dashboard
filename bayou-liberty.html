<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bayou Liberty, LA - Dashboard</title>
  <link href="https://unpkg.com/leaflet/dist/leaflet.css" rel="stylesheet" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <link href="manifest.json" rel="manifest"/>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f4f4f4;
      margin: 0;
      padding: 20px;
      color: #2c5782;
      text-align: center;
    }
    header {
      background-color: #2c5782;
      padding: 12px 20px;
      color: white;
      text-align: center;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    nav {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 12px;
      font-size: 1em;
    }
    nav a {
      color: white;
      text-decoration: none;
      font-weight: 500;
      transition: color 0.2s ease;
    }
    nav a:hover {
      text-decoration: underline;
    }
    .info {
      background: white;
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      margin-bottom: 20px;
      overflow-x: auto;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      font-size: 0.95em;
      margin: 0 auto;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: center;
    }
    th {
      background-color: #e0e0e0;
    }
    #map {
      height: 300px;
      width: 100%;
      max-width: 100%;
      margin: 20px 0;
      border-radius: 10px;
    }
    @media screen and (max-width: 600px) {
      nav { flex-direction: column; gap: 8px; }
      h1 { font-size: 1.3em; }
      table { font-size: 0.85em; }
    }
    @media print {
      header, nav, .nav-toggle { display: none !important; }
      div[style*="box-shadow"], .info { box-shadow: none !important; }
    }
  </style>
</head>
<body>
<header>
  <nav>
    <a href="index.html">Home</a>
    <a href="louisiana.html">Louisiana</a>
    <a href="bayou-liberty.html">Bayou Liberty</a>
    <a href="hessmer.html">Hessmer</a>
    <a href="homer.html">Homer</a>
    <a href="lake-charles.html">Lake Charles</a>
    <a href="shreveport.html">Shreveport</a>
    <a href="westwego.html">Westwego</a>
  </nav>
</header>
<h1>Bayou Liberty, LA - Dashboard</h1>
<div style="display: flex; justify-content: center; gap: 20px; margin: 20px 0; flex-wrap: wrap;">
  <div style="flex: 1 1 300px; background: white; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); padding: 20px; text-align: center;">
    <h2 style="margin: 0; color: #2c5782;">Total Meters / Missing Reads</h2>
    <p id="total-missing" style="font-size: 1.8em; margin: 10px 0;">Loading...</p>
  </div>
  <div style="flex: 1 1 300px; background: white; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); padding: 20px; text-align: center;">
    <h2 style="margin: 0; color: #2c5782;">Reading Performance</h2>
    <p id="reading-performance" style="font-size: 2em; margin: 10px 0;">Loading...</p>
  </div>
  <div style="flex: 1 1 300px; background: white; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); padding: 20px; text-align: center;">
    <h2 style="margin: 0; color: #2c5782;">Collector Status</h2>
    <p id="collector-status" style="font-size: 1.8em; margin: 10px 0;">Loading...</p>
  </div>
  </div>
</div>
<div id="map"></div>
<div class="info">
  <table>
    <thead>
      <tr><th>Collector Name</th><th>Serial Number</th><th>Last Contact</th><th>Comments</th></tr>
    </thead>
    <tbody>
      <tr><td id="name-73375555">Loading...</td><td>73375555</td><td id="date-73375555">Loading...</td><td id="comment-73375555">Loading...</td></tr>
      <tr><td id="name-73375489">Loading...</td><td>73375489</td><td id="date-73375489">Loading...</td><td id="comment-73375489">Loading...</td></tr>
    </tbody>
  </table>
</div>


<div style="display: flex; flex-wrap: wrap; justify-content: center; gap: 20px; margin-top: 30px;">
  
  
</div>


<div style="display: flex; flex-wrap: wrap; justify-content: center; gap: 20px; margin-top: 30px;">
  
<div style="width: 100%; margin-top: 10px;">
    </div>
</div>

  
<div style="flex: 1 1 300px; background: white; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); padding: 10px 10px 5px; text-align: center;">
<h2 style="margin: 0; color: #b91c1c; font-size: 1.1em;">HIGH Priority Info Codes</h2>
  <p id="high-priority-codes" style="font-size: 1.6em; margin: 10px 0; color: #b91c1c;"></p>
<canvas id="infoCodeChart" height="120" style="margin-top: 10px;"></canvas>
</div>

</div>

<div style="margin-top: 30px;">
  <a href="louisiana.html" style="display:inline-block;padding:10px 20px;background:#2c5782;color:white;text-decoration:none;border-radius:5px;">← Back to Louisiana Collectors</a>
</div>
<script>
function updateCollectorStatus() {
  Papa.parse("https://docs.google.com/spreadsheets/d/e/2PACX-1vQyeLPDZNq8dJ6_3DDD1yTXDw66v56SM9uUvwddYm51NJG4EojAKdM_YV9ifOBJt0-yl6wUZ5Xf22Io/pub?gid=96572475&single=true&output=csv", {
    download: true,
    header: false,
    complete: function(results) {
      const data = results.data.slice(1);
      let onlineCount = 0;
      let offlineCount = 0;

      data.forEach(row => {
        const city = row[0]?.trim().toLowerCase();
        const issue = row[5]?.trim().toLowerCase();

        if (city === "bayou liberty") {
          if (issue === "yes") {
            offlineCount++;
          } else if (issue === "no") {
            onlineCount++;
          }
        }
      });

      const statusEl = document.getElementById("collector-status");
      statusEl.innerText = `Online: ${onlineCount} / Offline: ${offlineCount}`;
      statusEl.style.color = offlineCount > 0 ? "#e11d48" : "#10b981";
    }
  });
}
document.addEventListener("DOMContentLoaded", updateCollectorStatus);
</script>
<script>
document.addEventListener("DOMContentLoaded", function () {
  var map = L.map('map').setView([30.285, -89.818], 13);

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19,
    attribution: '© OpenStreetMap contributors'
  }).addTo(map);

  var waterTower = L.marker([30.27077, -89.82333]).addTo(map)
    .bindPopup("Water Tower Collector");

  var well3 = L.marker([30.30153, -89.81293]).addTo(map)
    .bindPopup("Well #3 Collector");

  map.fitBounds([
    [30.27077, -89.82333],
    [30.30153, -89.81293]
  ]);
});
</script>

<script>
function updateReadingAndMissingData() {
  Papa.parse("https://docs.google.com/spreadsheets/d/e/2PACX-1vQyeLPDZNq8dJ6_3DDD1yTXDw66v56SM9uUvwddYm51NJG4EojAKdM_YV9ifOBJt0-yl6wUZ5Xf22Io/pub?gid=0&single=true&output=csv", {
    download: true,
    header: true,
    complete: function(results) {
      const data = results.data;
      const row = data.find(r => r["City"]?.trim().toLowerCase() === "bayou liberty");

      if (row) {
        const totalMeters = row["Total Meters"] || "N/A";
        const missingReads = row["Meters with Missing Reads"] || "N/A";
        const performance = row["Performance (%)"] || "N/A";

        document.getElementById("total-missing").innerText = `${totalMeters} / ${missingReads}`;
        document.getElementById("reading-performance").innerText = performance;
      } else {
        document.getElementById("total-missing").innerText = "Not Found";
        document.getElementById("reading-performance").innerText = "Not Found";
      }
    },
    error: function(err) {
      console.error("Error loading CSV:", err);
    }
  });
}

document.addEventListener("DOMContentLoaded", updateReadingAndMissingData);
</script>


<script>
function updateCollectorTable() {
  const serials = ["73375555", "73375489"];

  Papa.parse("https://docs.google.com/spreadsheets/d/e/2PACX-1vQyeLPDZNq8dJ6_3DDD1yTXDw66v56SM9uUvwddYm51NJG4EojAKdM_YV9ifOBJt0-yl6wUZ5Xf22Io/pub?gid=96572475&single=true&output=csv", {
    download: true,
    header: true,
    complete: function(results) {
      const data = results.data;

      serials.forEach(serial => {
        const match = data.find(row => row["Serial Number"]?.trim() === serial);

        if (match) {
          document.getElementById(`name-${serial}`).innerText = match["Collector Name"] || "N/A";
          document.getElementById(`date-${serial}`).innerText = match["Last Contact"] || "N/A";
          document.getElementById(`comment-${serial}`).innerText = match["Comments"] || "N/A";
        } else {
          document.getElementById(`name-${serial}`).innerText = "Not Found";
          document.getElementById(`date-${serial}`).innerText = "Not Found";
          document.getElementById(`comment-${serial}`).innerText = "Not Found";
        }
      });
    },
    error: function(err) {
      console.error("Error loading collector data:", err);
    }
  });
}

document.addEventListener("DOMContentLoaded", updateCollectorTable);
</script>




<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
<script>
function renderInfoCodeChart() {
  Papa.parse("https://docs.google.com/spreadsheets/d/e/2PACX-1vQKvCYwfdM0Pr8FR86WI4tkteELWXNLejguUNygSG41R9blMjXLB6atYKmWvvI5Z8tOfZ7EC62A4I4l/pub?gid=188207719&single=true&output=csv", {
    download: true,
    header: true,
    complete: function(results) {
      const data = results.data.filter(r => r["Info Code"] && r["Count"]);
      const labels = data.map(row => row["Info Code"]);
      const counts = data.map(row => parseInt(row["Count"], 10));

      const ctx = document.getElementById("infoCodeChart");
      if (ctx) {
        new Chart(ctx.getContext("2d"), {
          type: "bar",
          data: {
            labels: labels,
            datasets: [{
              label: "Count",
              data: counts,
              backgroundColor: "#f87171"
            }]
          },
          options: {
            responsive: true,
            scales: {
              y: { beginAtZero: true }
            },
            plugins: {
              legend: { display: false },
              title: {
                display: true,
                text: "Info Codes (Bayou Liberty)",
                font: { size: 16 }
              },
              tooltip: {
                callbacks: {
                  label: function(context) {
                    return `Count: ${context.raw}`;
                  }
                }
              }
            }
          }
        });
      }
    },
    error: function(err) {
      console.error("Failed to parse info code CSV", err);
    }
  });
}
document.addEventListener("DOMContentLoaded", renderInfoCodeChart);

Chart.defaults.font.size = 12;

new Chart(ctx.getContext("2d"), {
  type: "bar",
  data: {
    labels: labels,
    datasets: [{
      label: "Count",
      data: counts,
      backgroundColor: "#f87171"
    }]
  },
  options: {
    responsive: true,
    scales: {
      y: { beginAtZero: true }
    },
    plugins: {
      legend: { display: false },
      title: {
        display: true,
        text: "Info Codes (Bayou Liberty)",
        font: { size: 16 }
      },
      tooltip: {
        callbacks: {
          label: function(context) {
            return `Count: ${context.raw}`;
          }
        }
      },
      datalabels: {
        anchor: 'end',
        align: 'top',
        color: '#000',
        font: {
          weight: 'bold'
        },
        formatter: function(value) {
          return value;
        }
      }
    }
  },
  plugins: [ChartDataLabels]
});
</script>
</body>


</html>
